<div class="jumbotron">
  <h1>Essay Marker</h1>
  <p class="lead">
    The Ultimate Tool For Grading Student Papers
  </p>
</div>

<div class="row ">
  <!-- grading -->
  <div class="col-sm-5">
    <div class="row">
      <div class="col-sm-8">
        Current Grade: {{getTotal() / totalPoints*100 | number:1}}%
      </div>
      <div class="col-sm-4">
        Words: {{getWordCount()}}
      </div>
    </div>
    <div class="textAngular" ta-toolbar=[['h1','h2','h3'],['bold','italics','underline']] text-angular ng-model="text">
      <textarea></textarea>
    </div>
  </div>
  
  <div class="col-sm-7">
    <div class="row">
      <button class="btn btn-secondary btn-group" ng-class="{'btn-primary':is(1)}" ng-click="section(1)">Comments</button>
      <button class="btn btn-secondary btn-group " ng-click="section(2)" ng-class="{'btn-primary':is(2)}">Grade</button>
      <button class="btn btn-secondary btn-group " ng-click="section(3) " ng-class="{'btn-primary':is(3)}">Options</button>
      <button class="btn btn-secondary btn-group " ng-click="section(4)" ng-class="{'btn-primary':is(4)}">RegEx</button>
      <button class="btn btn-secondary btn-group " ng-click="section(5)" ng-class="{'btn-primary':is(5)}">Plagiarism</button>
      <button class="btn btn-secondary btn-group " ng-click="section(6)" ng-class="{'btn-primary':is(6)}">New Comment</button>
    </div>
    <!-- Shows Comments available to insert -->
    <div class="row" ng-show="is(1)">
      <input class="filter form-control" placeholder="Filter" ng-model="filter"></input>
      <ul class="myComments col-sm-12" >
        <!-- repeat each comment element -->
        <li ng-repeat="comment in comments | filter:filter track by $index" class="card">
         <!-- ng-show="filtered(comment.selectedComment)"> -->
          <div class="row" ng-click="showFullComment=!showFullComment">
            <div class="col-sm-6">
              <span><strong>Section:</strong></span>
              <span  ng-model="comment.category">{{comment.category}}</span>        
            </div>
            <div class="col-sm-6">
              <span><strong>Subsection:</strong></span>
              <span ng-model="comment.subsection">{{comment.subsection}}</span>
            </div>
          </div>
          <div class="row" ng-show="showFullComment">
            <div class="col-sm-12">
              <label>Grading Category:</label> <select ng-model="comment.selectedCategory" ng-options="name for name in categoryNames()"></select>
            </div>
          </div>
          <div class="row" ng-show="showFullComment">
            <div class="col-sm-12">
              <label>Comment:</label>
              <select ng-model="comment.selectedComment" ng-options="newComment.slice(0,10) for newComment in comment.comments ">
              </select>              
            </div>
          </div>
                
          <div class="row" ng-show="showFullComment">
            <div class="col-sm-12">
              {{comment.selectedComment}}             
            </div>
          </div>
          <div class="row" ng-show="showFullComment">
            <div class="col-sm-12">
              <label>Example</label>
              <input type="text" ng-model="comment.example" value="{{comment.example}}"></input>
              <button class="btn btn-primary" ng-click="addComment(comment, $index)">Add Comment</button>  
            </div>     
          </div>
          
        </li>
      </ul>
    </div>

    <!-- Auto Grading Options -->
    <div class="row" ng-show="is(2)">
      <button class="btn btn-primary" ng-click="gradeEssay()">Auto Grade</button>
      <!-- shows all categories  -->
      <div class="myComments">
        <p>This is a list of all the autograding options. Each option is a regular expression with a comment associated with it. You can toggle these regular expressions to check your own work.</p>
        <ul ng-repeat="category in categories" class="">
          <h3>{{category.name}}
          </h3>
          <button class="btn btn-secondary" ng-click="addError(category)">Add new Error</button>
          <li ng-repeat="error in category.errors" class="card">
            <div class="row">
              <div class="col-md-2">
                <button ng-init="error.on=true" ng-model="error.on" ng-click="error.on=!error.on" ng-class="{'btn tgl-on':error.on, 'btn tg-off':!error.on}">
                  Turned {{error.on ? 'On':'Off'}}
                </button>
              </div>
              <div class="col-sm-10" ng-click="errorShow=!errorShow">
                #{{$index+1}} - {{error.name | limitTo: 70 }}{{error.name.length > 70 ? '&hellip;' : ''}} 
              </div>
            </div>
            <div class="row" ng-show="errorShow">
              <div class="col-md-5">
                <span>#{{$index+1}} - </span>
                <label>RegEx</label>
                <textarea class="form-control" ng-model="error.re"></textarea>
                
              </div>
              <div class="col-md-7">
                <label>Comment</label>
                <textarea class="form-control" ng-model="error.comment"></textarea>
              </div>             
            </div>
            <div class="row" ng-show="errorShow">
              <div class="col-md-2 pull-right">
                <button class="btn btn-remove" align="center" ng-click="removeError(category,error)">X</button>
              </div>
            </div>
          </li>
        </ul>  
      </div>

    </div>
    <!-- General Options -->
    <div class="row" ng-show="is(3)">
      <div class="row">
        <div class="col-sm-4"><label>
          Min Length</label>
          <input class="form-control" type="text" ng-model="minLength" \>
        </div>
        <div class="col-sm-4">
          <label>Total Points</label>
          <input class="form-control" type="text" ng-model="totalPoints" \>
        </div>
        <div class="col-sm-4">
          <label>Def Value</label>
          <input class="form-control" type="text" ng-model="defValue" \>
        </div>        
      </div>
      <div class="row">
        <div class="col-sm-4">
          <label>Decrease By</label><input class="form-control" type="text" ng-model="decreaseBy"></div>
      </div>
      <div class="row">
        <div class="col-sm-12">
          <label>Key Words</label>
          <textarea class="form-control" ng-model="keyWords"></textarea>
        </div>
      </div>
    </div>

    <!-- Check Expressions -->
    <div class="row" ng-show="is(4)">
      <p>You can test regular expressions here and then enter the comments into your own autoGrade function.</p>
      <div class="col-sm-12">
        <label>Short Name</label>
        <input type="text" class="form-control" ng-model="customError.name">
      </div>
      <div class="col-sm-12">
        <label>Regular Expression (Which Evaluates on AutoGrade)</label>
        <div class="input-group">
          <span class="input-group-addon">/(</span>
          <input type="text" class="form-control input-group" ng-model="customError.re"><span class="input-group-addon">)/gi</span>
        </div>
      </div>
      <div class="col-sm-12">
        <label>Custom Comment (appears under Specific Feedback if error is found)</label>
        <textarea class="form-control" ng-model="customError.comment"></textarea>
      </div>
      <div class="col-sm-12">
        <label>Category to be reduced</label>
        <select 
        ng-model="customErrCategory" ng-options="category.name for category in categories"></select>
        <button class="btn btn-primary" ng-click="addError(customErrCategory, customError); customError=defError"
        ng-show="customError.re.length">Add New Error</button>  
      </div>
    </div>

    <!-- Add New Comment -->
    <div class="row card" ng-show="is(6)">
      <h2 class="text-center">Create New Comment</h2>
      <div class="row">
        <div class="col-sm-6">
          <span><strong>Section:</strong></span>
          <select type="text" class="form-control" ng-model="newSection"  ng-options="section for section in sectionNames"></select>      
        </div>
        <div class="col-sm-6">
          <span><strong>Subsection:</strong></span>
          <input type="text" class="form-control" ng-model="newSubsection">
        </div>
      </div>
      <div class="row">
        <div class="col-sm-12">
          <label>Grading Category:</label> <select class="form-control" ng-model="newSelectedCategory" ng-options="name for name in categoryNames()"></select>
        </div>
      </div>
        <div class="row">
          <div class="col-sm-12">
            <label>Comments:</label>
            STATUS: BROKEN!!! Add ability to add more comments
            <button class="btn btn-primary btn-group" ng-click="addAllNewComment('')">+</button>              
              <select class="form-control" ng-model="newSelectedComment" ng-options="newComment.slice(0,20) for newComment in allNewComments track by $index">
              </select>
          </div>
        </div>
                
          <div class="row">
            <div class="col-sm-12">
              <textarea class="form-control" ng-model="newSelectedComment">
              </textarea>           
            </div>
          </div>
          <div class="row" ng-show="newSubsection.length && newSelectedComment.length">
            <div class="col-sm-12">
              <button class="btn btn-primary" ng-click="addToComments(comment, $index)">Add New Comment</button>  
            </div>     
          </div>
      </div>
    </div>
    <!-- External Plagairism Checker -->
  <div class="row-fluid" ng-show="is(5)">
      <iframe src="http://www.paperrater.com/plagiarism_checker/" style="zoom:0.60" width="55%" height="500" frameborder="0"
      clas="container well"></iframe>

    
  </div>

</div>
<!-- Feedback -->
  <div class="row">
    <button class="btn btn-default" ng-click="show=!show">Show / Hide Options</button>
  </div>
  <div class="row">
    <label>Specific Feedback</label>
      <ul>
        <li ng-repeat="myFeedback in feedback">{{myFeedback}}
        <button class="btn btn-danger" ng-click="removeFeedback($index)" ng-show="show">-</button>
        </li>
      </ul>
    <label>
      Additional Comments
    </label>
    <ul class="">
      <li ng-repeat="myComment in myComments track by $index"> 
        <p>
        {{myComment.selectedComment}}
        
        <span ng-show="{{myComment.example.length>0}}">
        (Example: {{myComment.example}})
        </span>
        <button class="btn btn-danger" ng-click="removeComment(myComment)" ng-show="show">-</button>
        </p>
      </li>
    </ul>
    <!-- grading table -->
    <div class="row">
      <table class="table">
        <tr ng-repeat="category in categories" >
            <td class="col-md-4">{{category.name}}</td>
            <td class="col-md-4">{{category.value < .5*defValue ? 'Needs Work':''}}</td>
            <td class="col-md-4"><strong>{{category.value}}</strong>
              <button class="btn btn-default" ng-click="category.value=category.value+decreaseBy" ng-show="show">+</button>
              <button class="btn btn-default" ng-click="category.value=category.value-decreaseBy" ng-show="show">-</button>
            </td>

        </tr>
        <tr>
          <td>Final Grade</td>
          <td></td>
          <td><strong>{{getTotal()}} / {{totalPoints}}</strong></td>
        </tr>
      </table>
    </div>

  </div>
</div>
